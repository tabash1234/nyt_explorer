<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
	<link href="https://fonts.googleapis.com/css?family=Alice|Averia+Serif+Libre|Limelight|Playfair+Display|Playfair+Display+SC|Vollkorn+SC|Yeseva+One|Zilla+Slab+Highlight" rel="stylesheet">
    <title>NYT explorer</title>

    <style type="text/css">
	
		html, body {
			margin: 0px;
			height: 100%;
			background-color:black;
		}

		#wrapper {
			background-color: #e3f2fd;
			min-height: 80%;
			height: auto;
			margin-bottom: -35px;
		}
		
		#root{
			height: 100%;
		}
	
		.header {	
			font-family: 'Yeseva One', cursive;
			display: flex;
			justify-content: center;
		}	
			
        .previews {
            width: 100%;
			background-color: #eee;	
			box-shadow: inset 0 0 7px #bbb;
			
        }
		
		.search {
			margin-bottom: 20px;
			display: flex;
			justify-content: center;
		}
		
		.inputbox{
			margin: 5px;
			width: 65px;
			height: 15px;
			border-radius: 5px;
			border-color: black;
			text-align: center;
		}
		
		.button{
			margin: 5px;
			width: 70px;
			height: 21px;
			background-color: black;
			color: white;
			border-radius: 5px;
			border-color: black;
		}

		.footer{
			display: flex;
			position: relative;
			justify-content: center;
			bottom: -55px;
			width: 100%;
			height: 40px;
			font-size: 14px;
			line-height: 60%;
			text-align: center;
			color: white;
			
		
		}
		
		@media screen and (orientation: landscape) {
		
		.page {
            display: flex;
		}
		
        .master {
            float: left;
            width: 82%;
        }

        .details {
            float: left;
            width: 18%;
            background-color: #FAE9C7;
            color: #2C2009;
            font-weight: bold;
			word-wrap: break-word;
			padding: 20px;
			
        }
		.sidebar{
			position: sticky;
			top:20px;
			font-size: 1.2vw;
		}
		
		.card{
			vertical-align:top;
			display: inline-block;
			width: 170px;
			height: 303px;
			margin: 10px;
			box-shadow: 3px 3px 2px #ddd;
			background-color: white;
			cursor: pointer;
		    color: #262626;
		    padding:10px;
		}
		
		.picture{
			height: 170px;
			width: 170px;		   
			object-fit: cover
		}
		
		.description {
			font-size: 11px;
			text-overflow: ellipsis;
			overflow: hidden;
			max-height: 73px;
			text-align: center;
			word-wrap: break-word;
		}
		
		.artTitle{
			font-weight: bold;
			font-size:12px
			text-overflow: ellipsis;
			overflow: hidden;
			word-wrap: break-word;		
			height: 55px;
			text-align: center;
		}		
		
		
	}
	
	@media screen and (orientation: portrait) {
	
		.page {
            display: absolute;
			width: 100%;
		}
		
	
       .details {
			position: sticky;
			display: flex;
			bottom: 1em;		
			width: 97%;
			min-height: 230px;
			height:auto;
            background-color: #FAE9C7;
            color: #2C2009;
			word-wrap: break-word;
			padding-left: 3%;
			font-size: 12px;
			
        }
		
		
		.header {	
			font-family: 'Yeseva One', cursive;
			display: flex;
			justify-content: center;
			font-size: 3vw;
			
		}	
		
		.card{
			vertical-align:top;
			display: inline-block;
			width: 97%;
			height: 200px;
			margin-top:10px;
			box-shadow: 3px 3px 2px #ddd;
			background-color: white;
			cursor: pointer;
		    color: #262626;
			padding-left: 3%;
			padding-top: 3%;
		    
		}
		
		.picture{
			height: 150px;
			width: 150px;		   
			object-fit: cover
		}
		
		.description {
			margin-left:10px;
			font-size: 15px;
			vertical-align:top;
			display: inline-block;
			text-overflow: ellipsis;
			overflow: hidden;
			max-height: 150px;
			text-align: left;
			word-wrap: break-word;
			max-width: 60%
		}
		
		.artTitle{
			font-weight: bold;
			font-size:23px;
			text-overflow: ellipsis;
			overflow: hidden;
			word-wrap: break-word;		
			height: 30px;
			text-align: left;
			padding-right:3%
		}
		
		
	}
		
		
		
		

		
    </style>
</head>

<body>
	<div id='wrapper'>
		<div class='header'>
			<header>
				<h1>Explore The New York Times</h1>
				<div class='search'>
					<input type='number' placeholder='year' id='year' class='inputbox' max='2018' min='1851'> 
					<input type='number' placeholder='month' id='month'class='inputbox' max='12' min='1'>
					<button onclick= 'find()' class='button'>Find</button>
				</div>
			</header>
		</div>
		<div id="root"/></div>
	</div>
	<div class='footer'>
		<footer>
			<p>Data provided by NY Times API</p>
			<p>Links preview by LinkPreview API</p>
			<p>Developed by Milena Tabasevic</p>
			<p>Contact: 
				<a href='mailto:milenatabash@yahoo.com'>milenatabash@yahoo.com</a>
			</p>
		</footer>
	</div>
    <script type="text/babel">

        class App extends React.Component {

            constructor(props){
                super(props);
				
                this.state = {
                    data: [],
                    selectedArticle: {
						id: 'article ID',
						headline: 'Browse through New York Times archives',
                        snippet: 'See short clip from the article, along with more data such as:',
                        word_count: 'number of words used',
                        pub_date: 'publication data and time',
                        web_url: 'and direct link to the page'
                    },
					year: '',
					month: '',
                };
				
                this.setData = this.setData.bind(this);
                this.handleArticleClick = this.handleArticleClick.bind(this);
				this.setYearAndMonth = this.setYearAndMonth.bind(this);
                this.refresh = this.refresh.bind(this);
            }

            handleArticleClick(item){
                this.setState({selectedArticle: item});
            }
			
			setYearAndMonth(y,m) {
			if (y<1851||y>2018||m<1||m>12){
			alert('These numbers seem wrong');
			return}
			     this.setState({year: y,month: m});
                 this.refresh();
			}
			
			
            setData(requestedData){
				let article = [];
				for(var i = 0; i <20; i++) {
				const doc = requestedData.response.docs[i];
				article.push(doc);
				}
				console.log(requestedData);
                this.setState({data: article});
				
			
				
            }

            refresh(){
                if(!this.state.year || !this.state.month) {
                    return;
                }
                $.ajax({
                  url: 'https://api.nytimes.com/svc/archive/v1/' +  this.state.year + "/" + this.state.month + ".json",
                  method: 'GET',
                  data: {
                      'api-key': "2ad417c011a6487eb5483e0b98c4d096"
                  },
                  success: this.setData
                });
            }

            render(){
                return (
                    <div className="page">
					
					
                        <div className="master">
                            <ArticleResults 
                                selectionHandler={this.handleArticleClick} 
                                data={this.state.data}
								
								/>
                        </div>
                        <div className="details">
                            <ArticleDetails
                                artc={this.state.selectedArticle}/>
                        </div>
                    </div>
                );
            }

        }

        const ArticleDetails = (props) => {
            const artc = props.artc;
			
			
            return (
                <div className = 'sidebar'>
                    
						<h1>{artc.headline.main}</h1>
                        <li>ID: {artc._id}</li>

                        
                        <p>Preview: {artc.snippet}</p>
						
						
                        <li>Published: {artc.pub_date.substr(0, 10)}</li>
						<li>Word count:{artc.word_count}</li>
						
                        <a href={artc.web_url} target="_blank"> {artc.web_url}</a>
                    
                </div>
            );
        }

        class Article extends React.Component{
             
            constructor(props){
            super(props);
            this.state = {
                 title: '',
                 description: '',
                 image: '',
                 url: '',
				 checkurl: ''
             };
           
             this.onSuccess = this.onSuccess.bind(this);
			 this.restart = this.restart.bind(this);
       }
           
            onSuccess(responseData){
               console.log(responseData);
               let title = responseData.title;
               let description = responseData.description;
               let image = responseData.image;
               this.setState({
                   'title': title, 
                   'description': description, 
                   'image': image, 
				   'checkurl':this.props.item.web_url
               });
               
           }
		   
 
		restart(){
        // const apiKey = '5a954263563083d29fb5278af9da98e9e7c9d3c97b9e2';
		const url = 'https://api.linkpreview.net/?key=123456&q=https://www.google.com';
        // const url = `https://api.linkpreview.net/?key=${apiKey}&q=${this.props.item.web_url}`;
        $.ajax({
          url,
          success: this.onSuccess
        });
       }  


		componentDidMount(){
         this.restart(); 
       } 

		   
		componentDidUpdate(){  
		if (this.state.checkurl == this.props.item.web_url){return}
		this.restart();  
		}
	  
            render(){
                const artBlock = this.props.item;
                const clickHandler = this.props.clickHandler;
                const block =
                    <div className='card' onClick={() => clickHandler(artBlock)}>
                     <div className= 'artTitle'>{this.state.title} </div>
					 <img src={this.state.image} className = 'picture'/>
                     <div className= 'description'>{this.state.description}</div>
                    </div>;
                return block;
            }
        }

        class ArticleResults extends React.Component {

            render() {
                const articles = this.props.data;

                const tableResults =
                    <div className='previews'>
                            {
                                articles.map(
                                    (artc, index) => <Article
                                        key={index}
                                        item={artc}
                                        clickHandler={this.props.selectionHandler} />
                                )
                            }
                    </div>;
                 return tableResults;
            }
        }
		
		var app;

        function find(){
            const root = document.getElementById('root');
            if(!app){
                app = ReactDOM.render(<App />,  root);    
            }
            var y = document.getElementById('year').value
            var m = document.getElementById('month').value
            app.setYearAndMonth(y, m);
        }
    </script>
</body>

</html>
